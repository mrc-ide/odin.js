<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>odin JavaScript support • odin.js</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="odin JavaScript support">
<meta property="og:description" content="Create JavaScript differential equation models from an
    odin model specification.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">odin.js</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="odinjs" class="section level2">
<h2 class="hasAnchor">
<a href="#odinjs" class="anchor"></a>odin.js</h2>
<!-- badges: start -->

<p>Support for compiling <a href="https://github.com/mrc-ide/odin">odin</a> models to javascript.</p>
<div id="use-from-r" class="section level3">
<h3 class="hasAnchor">
<a href="#use-from-r" class="anchor"></a>Use from R</h3>
<p>The function <code><a href="reference/odin_js.html">odin.js::odin_js</a></code> provides a (roughly drop-in) replacement for <code><a href="https://rdrr.io/pkg/odin/man/odin.html">odin::odin</a></code> for compiling an odin model for use within R:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">logistic</span> <span class="op">&lt;-</span> <span class="fu">odin.js</span><span class="fu">::</span><span class="fu"><a href="reference/odin_js.html">odin_js</a></span><span class="op">(</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/deriv.html">deriv</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">r</span> <span class="op">*</span> <span class="va">N</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">N</span> <span class="op">/</span> <span class="va">K</span><span class="op">)</span>
  <span class="fu">initial</span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">N0</span>
  <span class="va">N0</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
  <span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">100</span>
  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="va">logistic</span></code></pre></div>
<pre><code>## function (..., user = list(...), unused_user_action = NULL)
## &lt;an 'odin_generator' function&gt;
##   use coef() to get information on user parameters</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">logistic</span><span class="op">(</span>r <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>##        t         N
##  [1,]  0  1.000000
##  [2,]  1  2.672363
##  [3,]  2  6.945318
##  [4,]  3 16.866483
##  [5,]  4 35.546124
##  [6,]  5 59.986009
##  [7,]  6 80.295740
##  [8,]  7 91.719886
##  [9,]  8 96.785679
## [10,]  9 98.792996
## [11,] 10 99.552555</code></pre>
<p>This might be slightly faster than the odin-to-R compiler, though benchmarks will have to wait until <code>odin.js</code> supports more odin features.</p>
</div>
<div id="use-from-webpages" class="section level3">
<h3 class="hasAnchor">
<a href="#use-from-webpages" class="anchor"></a>Use from webpages</h3>
<p>The function <code><a href="reference/odin_js_bundle.html">odin.js::odin_js_bundle</a></code> generates a “bundle” of javascript suitable for calling from a webpage. This is the same code that <code><a href="reference/odin_js.html">odin.js::odin_js</a></code> but without R-wrappers around it. It takes a vector of filenames and produces a file of javascript code:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu">odin.js</span><span class="fu">::</span><span class="fu"><a href="reference/odin_js_bundle.html">odin_js_bundle</a></span><span class="op">(</span><span class="st">"inst/models/logistic.R"</span>,
                                include_dopri <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>The file at <code>path</code> now contains:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">// V8 does not support Array.fill from the look of it</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">function</span> <span class="at">zeros</span>(n) <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="kw">var</span> ret <span class="op">=</span> <span class="kw">new</span> <span class="at">Array</span>(n)<span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i) <span class="op">{</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>        ret[i] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="op">}</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>    <span class="cf">return</span> ret<span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="op">}</span></span>
<span id="cb6-9"><a href="#cb6-9"></a></span>
<span id="cb6-10"><a href="#cb6-10"></a></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="kw">function</span> <span class="at">integrateOdin</span>(obj<span class="op">,</span> times<span class="op">,</span> y0<span class="op">,</span> tcrit<span class="op">,</span> atol<span class="op">,</span> rtol<span class="op">,</span> maxSteps) <span class="op">{</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>    <span class="kw">var</span> t0 <span class="op">=</span> times[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>    <span class="kw">var</span> t1 <span class="op">=</span> times[<span class="va">times</span>.<span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb6-14"><a href="#cb6-14"></a>    <span class="cf">if</span> (<span class="va">obj</span>.<span class="va">metadata</span>.<span class="at">interpolateTimes</span> <span class="op">!==</span> <span class="kw">null</span>) <span class="op">{</span></span>
<span id="cb6-15"><a href="#cb6-15"></a>        tcrit <span class="op">=</span> <span class="at">interpolateCheckT</span>(times<span class="op">,</span> <span class="va">obj</span>.<span class="va">metadata</span>.<span class="at">interpolateTimes</span><span class="op">,</span> tcrit)<span class="op">;</span></span>
<span id="cb6-16"><a href="#cb6-16"></a>    <span class="op">}</span></span>
<span id="cb6-17"><a href="#cb6-17"></a>    <span class="cf">if</span> (<span class="at">isMissing</span>(y0)) <span class="op">{</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>      y0 <span class="op">=</span> <span class="va">obj</span>.<span class="at">initial</span>(times[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb6-19"><a href="#cb6-19"></a>    <span class="op">}</span></span>
<span id="cb6-20"><a href="#cb6-20"></a>    <span class="kw">var</span> rhs <span class="op">=</span> <span class="kw">function</span>(t<span class="op">,</span> y<span class="op">,</span> dy) <span class="op">{</span></span>
<span id="cb6-21"><a href="#cb6-21"></a>        <span class="va">obj</span>.<span class="at">rhs</span>(t<span class="op">,</span> y<span class="op">,</span> dy)<span class="op">;</span></span>
<span id="cb6-22"><a href="#cb6-22"></a>    <span class="op">};</span></span>
<span id="cb6-23"><a href="#cb6-23"></a>    <span class="kw">var</span> ctl <span class="op">=</span> <span class="op">{};</span></span>
<span id="cb6-24"><a href="#cb6-24"></a>    <span class="cf">if</span> (tcrit <span class="op">!==</span> <span class="kw">null</span>) <span class="op">{</span></span>
<span id="cb6-25"><a href="#cb6-25"></a>        <span class="va">ctl</span>.<span class="at">tcrit</span> <span class="op">=</span> tcrit<span class="op">;</span></span>
<span id="cb6-26"><a href="#cb6-26"></a>    <span class="op">}</span></span>
<span id="cb6-27"><a href="#cb6-27"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="at">isMissing</span>(atol)) <span class="op">{</span></span>
<span id="cb6-28"><a href="#cb6-28"></a>        <span class="va">ctl</span>.<span class="at">atol</span> <span class="op">=</span> atol<span class="op">;</span></span>
<span id="cb6-29"><a href="#cb6-29"></a>    <span class="op">}</span></span>
<span id="cb6-30"><a href="#cb6-30"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="at">isMissing</span>(rtol)) <span class="op">{</span></span>
<span id="cb6-31"><a href="#cb6-31"></a>        <span class="va">ctl</span>.<span class="at">rtol</span> <span class="op">=</span> rtol<span class="op">;</span></span>
<span id="cb6-32"><a href="#cb6-32"></a>    <span class="op">}</span></span>
<span id="cb6-33"><a href="#cb6-33"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="at">isMissing</span>(maxSteps)) <span class="op">{</span></span>
<span id="cb6-34"><a href="#cb6-34"></a>        <span class="va">ctl</span>.<span class="at">maxSteps</span> <span class="op">=</span> maxSteps<span class="op">;</span></span>
<span id="cb6-35"><a href="#cb6-35"></a>    <span class="op">}</span></span>
<span id="cb6-36"><a href="#cb6-36"></a>    <span class="kw">var</span> sol <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb6-37"><a href="#cb6-37"></a>    <span class="cf">if</span> (<span class="kw">typeof</span> <span class="va">obj</span>.<span class="at">output</span> <span class="op">===</span> <span class="st">"function"</span>) <span class="op">{</span></span>
<span id="cb6-38"><a href="#cb6-38"></a>        <span class="kw">var</span> output <span class="op">=</span> <span class="kw">function</span>(t<span class="op">,</span> y) <span class="op">{</span></span>
<span id="cb6-39"><a href="#cb6-39"></a>            <span class="cf">return</span> <span class="va">obj</span>.<span class="at">output</span>(t<span class="op">,</span> y)<span class="op">;</span></span>
<span id="cb6-40"><a href="#cb6-40"></a>        <span class="op">}</span></span>
<span id="cb6-41"><a href="#cb6-41"></a>        sol <span class="op">=</span> <span class="va">dopri</span>.<span class="at">integrate</span>(rhs<span class="op">,</span> y0<span class="op">,</span> t0<span class="op">,</span> t1<span class="op">,</span> ctl<span class="op">,</span> output)<span class="op">;</span></span>
<span id="cb6-42"><a href="#cb6-42"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-43"><a href="#cb6-43"></a>        sol <span class="op">=</span> <span class="va">dopri</span>.<span class="at">integrate</span>(rhs<span class="op">,</span> y0<span class="op">,</span> t0<span class="op">,</span> t1<span class="op">,</span> ctl)<span class="op">;</span></span>
<span id="cb6-44"><a href="#cb6-44"></a>    <span class="op">}</span></span>
<span id="cb6-45"><a href="#cb6-45"></a>    <span class="kw">var</span> y <span class="op">=</span> <span class="at">sol</span>(times)<span class="op">;</span></span>
<span id="cb6-46"><a href="#cb6-46"></a>    <span class="co">// Prepend the result vector with the times; this is going to be</span></span>
<span id="cb6-47"><a href="#cb6-47"></a>    <span class="co">// required later on - it would be nice if dopri did this through</span></span>
<span id="cb6-48"><a href="#cb6-48"></a>    <span class="co">// it's interpolation function though.</span></span>
<span id="cb6-49"><a href="#cb6-49"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">times</span>.<span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) <span class="op">{</span></span>
<span id="cb6-50"><a href="#cb6-50"></a>        y[i].<span class="at">unshift</span>(times[i])<span class="op">;</span></span>
<span id="cb6-51"><a href="#cb6-51"></a>    <span class="op">}</span></span>
<span id="cb6-52"><a href="#cb6-52"></a>    <span class="cf">return</span> <span class="op">{</span><span class="st">"y"</span><span class="op">:</span> y<span class="op">,</span> <span class="st">"names"</span><span class="op">:</span> <span class="va">obj</span>.<span class="va">metadata</span>.<span class="va">ynames</span>.<span class="at">slice</span>(<span class="dv">0</span>)<span class="op">};</span></span>
<span id="cb6-53"><a href="#cb6-53"></a><span class="op">}</span></span>
<span id="cb6-54"><a href="#cb6-54"></a></span>
<span id="cb6-55"><a href="#cb6-55"></a><span class="kw">function</span> <span class="at">getUser</span>(user<span class="op">,</span> name<span class="op">,</span> internal<span class="op">,</span> size<span class="op">,</span> defaultValue<span class="op">,</span></span>
<span id="cb6-56"><a href="#cb6-56"></a>                  min<span class="op">,</span> max<span class="op">,</span> isInteger) <span class="op">{</span></span>
<span id="cb6-57"><a href="#cb6-57"></a>    <span class="kw">var</span> value <span class="op">=</span> user[name]<span class="op">;</span></span>
<span id="cb6-58"><a href="#cb6-58"></a>    <span class="cf">if</span> (<span class="at">isMissing</span>(value)) <span class="op">{</span></span>
<span id="cb6-59"><a href="#cb6-59"></a>        <span class="cf">if</span> (<span class="at">isMissing</span>(internal[name])) <span class="op">{</span></span>
<span id="cb6-60"><a href="#cb6-60"></a>            <span class="cf">if</span> (defaultValue <span class="op">===</span> <span class="kw">null</span>) <span class="op">{</span></span>
<span id="cb6-61"><a href="#cb6-61"></a>                <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected a value for '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb6-62"><a href="#cb6-62"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-63"><a href="#cb6-63"></a>                internal[name] <span class="op">=</span> defaultValue<span class="op">;</span></span>
<span id="cb6-64"><a href="#cb6-64"></a>            <span class="op">}</span></span>
<span id="cb6-65"><a href="#cb6-65"></a>        <span class="op">}</span></span>
<span id="cb6-66"><a href="#cb6-66"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-67"><a href="#cb6-67"></a>        <span class="cf">if</span> (<span class="kw">typeof</span> value <span class="op">!==</span> <span class="st">"number"</span>) <span class="op">{</span></span>
<span id="cb6-68"><a href="#cb6-68"></a>            <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected a numeric value for '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb6-69"><a href="#cb6-69"></a>        <span class="op">}</span></span>
<span id="cb6-70"><a href="#cb6-70"></a>        <span class="cf">if</span> (min <span class="op">!==</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> value <span class="op">&lt;</span> min) <span class="op">{</span></span>
<span id="cb6-71"><a href="#cb6-71"></a>            <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"' to be at least "</span> <span class="op">+</span> min)<span class="op">;</span></span>
<span id="cb6-72"><a href="#cb6-72"></a>        <span class="op">}</span></span>
<span id="cb6-73"><a href="#cb6-73"></a>        <span class="cf">if</span> (max <span class="op">!==</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> value <span class="op">&gt;</span> min) <span class="op">{</span></span>
<span id="cb6-74"><a href="#cb6-74"></a>            <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"' to be at most "</span> <span class="op">+</span> max)<span class="op">;</span></span>
<span id="cb6-75"><a href="#cb6-75"></a>        <span class="op">}</span></span>
<span id="cb6-76"><a href="#cb6-76"></a>        <span class="cf">if</span> (isInteger <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="at">numberIsInteger</span>(value)) <span class="op">{</span></span>
<span id="cb6-77"><a href="#cb6-77"></a>            <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"' to be integer-like"</span>)<span class="op">;</span></span>
<span id="cb6-78"><a href="#cb6-78"></a>        <span class="op">}</span></span>
<span id="cb6-79"><a href="#cb6-79"></a></span>
<span id="cb6-80"><a href="#cb6-80"></a>        internal[name] <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb6-81"><a href="#cb6-81"></a>    <span class="op">}</span></span>
<span id="cb6-82"><a href="#cb6-82"></a><span class="op">}</span></span>
<span id="cb6-83"><a href="#cb6-83"></a></span>
<span id="cb6-84"><a href="#cb6-84"></a></span>
<span id="cb6-85"><a href="#cb6-85"></a><span class="kw">function</span> <span class="at">getUserArray</span>(user<span class="op">,</span> name<span class="op">,</span> internal<span class="op">,</span> size<span class="op">,</span> defaultValue<span class="op">,</span></span>
<span id="cb6-86"><a href="#cb6-86"></a>                      min<span class="op">,</span> max<span class="op">,</span> isInteger) <span class="op">{</span></span>
<span id="cb6-87"><a href="#cb6-87"></a>    <span class="kw">var</span> value <span class="op">=</span> user[name]<span class="op">;</span></span>
<span id="cb6-88"><a href="#cb6-88"></a></span>
<span id="cb6-89"><a href="#cb6-89"></a>    <span class="cf">if</span> (<span class="at">isMissing</span>(value)) <span class="op">{</span></span>
<span id="cb6-90"><a href="#cb6-90"></a>        <span class="cf">if</span> (<span class="at">isMissing</span>(internal[name])) <span class="op">{</span></span>
<span id="cb6-91"><a href="#cb6-91"></a>            <span class="cf">if</span> (defaultValue <span class="op">===</span> <span class="kw">null</span>) <span class="op">{</span></span>
<span id="cb6-92"><a href="#cb6-92"></a>                <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected a value for '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb6-93"><a href="#cb6-93"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-94"><a href="#cb6-94"></a>                <span class="co">// not totally clear how to do this as we need to get</span></span>
<span id="cb6-95"><a href="#cb6-95"></a>                <span class="co">// the previous dimensions too!</span></span>
<span id="cb6-96"><a href="#cb6-96"></a>                <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"This needs implementing...."</span>)<span class="op">;</span></span>
<span id="cb6-97"><a href="#cb6-97"></a>                internal[name] <span class="op">=</span> defaultValue<span class="op">;</span></span>
<span id="cb6-98"><a href="#cb6-98"></a>            <span class="op">}</span></span>
<span id="cb6-99"><a href="#cb6-99"></a>        <span class="op">}</span></span>
<span id="cb6-100"><a href="#cb6-100"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb6-101"><a href="#cb6-101"></a>    <span class="op">}</span></span>
<span id="cb6-102"><a href="#cb6-102"></a></span>
<span id="cb6-103"><a href="#cb6-103"></a>    <span class="kw">var</span> rank <span class="op">=</span> <span class="va">size</span>.<span class="at">length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb6-104"><a href="#cb6-104"></a>    value <span class="op">=</span> <span class="at">getUserArrayCheckType</span>(value<span class="op">,</span> name)<span class="op">;</span></span>
<span id="cb6-105"><a href="#cb6-105"></a>    <span class="at">getUserArrayCheckRank</span>(rank<span class="op">,</span> <span class="va">value</span>.<span class="va">dim</span>.<span class="at">length</span><span class="op">,</span> name)<span class="op">;</span></span>
<span id="cb6-106"><a href="#cb6-106"></a></span>
<span id="cb6-107"><a href="#cb6-107"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> rank<span class="op">;</span> <span class="op">++</span>i) <span class="op">{</span></span>
<span id="cb6-108"><a href="#cb6-108"></a>        <span class="cf">if</span> (<span class="va">value</span>.<span class="at">dim</span>[i] <span class="op">!==</span> size[i <span class="op">+</span> <span class="dv">1</span>]) <span class="op">{</span></span>
<span id="cb6-109"><a href="#cb6-109"></a>            <span class="cf">if</span> (rank <span class="op">==</span> <span class="dv">1</span>) <span class="op">{</span></span>
<span id="cb6-110"><a href="#cb6-110"></a>                <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected length "</span> <span class="op">+</span> size[i <span class="op">+</span> <span class="dv">1</span>] <span class="op">+</span></span>
<span id="cb6-111"><a href="#cb6-111"></a>                            <span class="st">" value for '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb6-112"><a href="#cb6-112"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-113"><a href="#cb6-113"></a>                <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Incorrect size of dimension "</span> <span class="op">+</span> (i <span class="op">+</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb6-114"><a href="#cb6-114"></a>                            <span class="st">" of '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"' (expected "</span> <span class="op">+</span> size[i <span class="op">+</span> <span class="dv">1</span>] <span class="op">+</span></span>
<span id="cb6-115"><a href="#cb6-115"></a>                            <span class="st">")"</span>)<span class="op">;</span></span>
<span id="cb6-116"><a href="#cb6-116"></a>            <span class="op">}</span></span>
<span id="cb6-117"><a href="#cb6-117"></a>        <span class="op">}</span></span>
<span id="cb6-118"><a href="#cb6-118"></a>    <span class="op">}</span></span>
<span id="cb6-119"><a href="#cb6-119"></a></span>
<span id="cb6-120"><a href="#cb6-120"></a>    <span class="at">getUserArrayCheckContents</span>(<span class="va">value</span>.<span class="at">data</span><span class="op">,</span> min<span class="op">,</span> max<span class="op">,</span> isInteger<span class="op">,</span> name)<span class="op">;</span></span>
<span id="cb6-121"><a href="#cb6-121"></a></span>
<span id="cb6-122"><a href="#cb6-122"></a>    internal[name] <span class="op">=</span> <span class="va">value</span>.<span class="va">data</span>.<span class="at">slice</span>()<span class="op">;</span></span>
<span id="cb6-123"><a href="#cb6-123"></a><span class="op">}</span></span>
<span id="cb6-124"><a href="#cb6-124"></a></span>
<span id="cb6-125"><a href="#cb6-125"></a><span class="co">// With arrays there are really two ways that they might come in; on</span></span>
<span id="cb6-126"><a href="#cb6-126"></a><span class="co">// the one hand we could accept json-style nested arrays, which is</span></span>
<span id="cb6-127"><a href="#cb6-127"></a><span class="co">// cool, but requires considerable checking.  Or, given we want</span></span>
<span id="cb6-128"><a href="#cb6-128"></a><span class="co">// C-style arrays ultimately we could use an R-style construct like:</span></span>
<span id="cb6-129"><a href="#cb6-129"></a><span class="co">// {"data": &lt;array&gt;, "dim": &lt;array&gt;}.  I'm doing the latter for now,</span></span>
<span id="cb6-130"><a href="#cb6-130"></a><span class="co">// and we can revisit later.</span></span>
<span id="cb6-131"><a href="#cb6-131"></a><span class="kw">function</span> <span class="at">getUserArrayDim</span>(user<span class="op">,</span> name<span class="op">,</span> internal<span class="op">,</span> size<span class="op">,</span> defaultValue<span class="op">,</span></span>
<span id="cb6-132"><a href="#cb6-132"></a>                         min<span class="op">,</span> max<span class="op">,</span> isInteger) <span class="op">{</span></span>
<span id="cb6-133"><a href="#cb6-133"></a>    <span class="kw">var</span> value <span class="op">=</span> user[name]<span class="op">;</span></span>
<span id="cb6-134"><a href="#cb6-134"></a></span>
<span id="cb6-135"><a href="#cb6-135"></a>    <span class="cf">if</span> (<span class="at">isMissing</span>(value)) <span class="op">{</span></span>
<span id="cb6-136"><a href="#cb6-136"></a>        <span class="cf">if</span> (<span class="at">isMissing</span>(internal[name])) <span class="op">{</span></span>
<span id="cb6-137"><a href="#cb6-137"></a>            <span class="cf">if</span> (defaultValue <span class="op">===</span> <span class="kw">null</span>) <span class="op">{</span></span>
<span id="cb6-138"><a href="#cb6-138"></a>                <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected a value for '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb6-139"><a href="#cb6-139"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-140"><a href="#cb6-140"></a>                <span class="co">// not totally clear how to do this as we need to get</span></span>
<span id="cb6-141"><a href="#cb6-141"></a>                <span class="co">// the previous dimensions too!</span></span>
<span id="cb6-142"><a href="#cb6-142"></a>                <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"This needs implementing...."</span>)<span class="op">;</span></span>
<span id="cb6-143"><a href="#cb6-143"></a>                internal[name] <span class="op">=</span> defaultValue<span class="op">;</span></span>
<span id="cb6-144"><a href="#cb6-144"></a>            <span class="op">}</span></span>
<span id="cb6-145"><a href="#cb6-145"></a>        <span class="op">}</span></span>
<span id="cb6-146"><a href="#cb6-146"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb6-147"><a href="#cb6-147"></a>    <span class="op">}</span></span>
<span id="cb6-148"><a href="#cb6-148"></a></span>
<span id="cb6-149"><a href="#cb6-149"></a>    <span class="kw">var</span> rank <span class="op">=</span> <span class="va">size</span>.<span class="at">length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb6-150"><a href="#cb6-150"></a>    value <span class="op">=</span> <span class="at">getUserArrayCheckType</span>(value<span class="op">,</span> name)<span class="op">;</span></span>
<span id="cb6-151"><a href="#cb6-151"></a>    <span class="at">getUserArrayCheckRank</span>(rank<span class="op">,</span> <span class="va">value</span>.<span class="va">dim</span>.<span class="at">length</span><span class="op">,</span> name)<span class="op">;</span></span>
<span id="cb6-152"><a href="#cb6-152"></a>    <span class="at">getUserArrayCheckContents</span>(<span class="va">value</span>.<span class="at">data</span><span class="op">,</span> min<span class="op">,</span> max<span class="op">,</span> isInteger<span class="op">,</span> name)<span class="op">;</span></span>
<span id="cb6-153"><a href="#cb6-153"></a></span>
<span id="cb6-154"><a href="#cb6-154"></a>    <span class="kw">var</span> len <span class="op">=</span> <span class="va">value</span>.<span class="va">data</span>.<span class="at">length</span><span class="op">;</span></span>
<span id="cb6-155"><a href="#cb6-155"></a>    size[<span class="dv">0</span>] <span class="op">=</span> len<span class="op">;</span></span>
<span id="cb6-156"><a href="#cb6-156"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> rank<span class="op">;</span> <span class="op">++</span>i) <span class="op">{</span></span>
<span id="cb6-157"><a href="#cb6-157"></a>        size[i <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> <span class="va">value</span>.<span class="at">dim</span>[i]<span class="op">;</span></span>
<span id="cb6-158"><a href="#cb6-158"></a>    <span class="op">}</span></span>
<span id="cb6-159"><a href="#cb6-159"></a></span>
<span id="cb6-160"><a href="#cb6-160"></a>    internal[name] <span class="op">=</span> <span class="va">value</span>.<span class="va">data</span>.<span class="at">slice</span>()<span class="op">;;</span></span>
<span id="cb6-161"><a href="#cb6-161"></a><span class="op">}</span></span>
<span id="cb6-162"><a href="#cb6-162"></a></span>
<span id="cb6-163"><a href="#cb6-163"></a></span>
<span id="cb6-164"><a href="#cb6-164"></a><span class="kw">function</span> <span class="at">getUserArrayCheckType</span>(value<span class="op">,</span> name) <span class="op">{</span></span>
<span id="cb6-165"><a href="#cb6-165"></a>    <span class="cf">if</span> (<span class="va">Array</span>.<span class="at">isArray</span>(value)) <span class="op">{</span></span>
<span id="cb6-166"><a href="#cb6-166"></a>        value <span class="op">=</span> <span class="at">flattenArray</span>(value<span class="op">,</span> name)</span>
<span id="cb6-167"><a href="#cb6-167"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (<span class="op">!</span>(<span class="kw">typeof</span> value <span class="op">===</span> <span class="st">"object"</span> <span class="op">&amp;&amp;</span></span>
<span id="cb6-168"><a href="#cb6-168"></a>                 <span class="st">"data"</span> <span class="kw">in</span> value <span class="op">&amp;&amp;</span></span>
<span id="cb6-169"><a href="#cb6-169"></a>                 <span class="st">"dim"</span> <span class="kw">in</span> value)) <span class="op">{</span></span>
<span id="cb6-170"><a href="#cb6-170"></a>        <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected an odin.js array object for '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb6-171"><a href="#cb6-171"></a>    <span class="op">}</span></span>
<span id="cb6-172"><a href="#cb6-172"></a>    <span class="cf">return</span> value<span class="op">;</span></span>
<span id="cb6-173"><a href="#cb6-173"></a><span class="op">}</span></span>
<span id="cb6-174"><a href="#cb6-174"></a></span>
<span id="cb6-175"><a href="#cb6-175"></a></span>
<span id="cb6-176"><a href="#cb6-176"></a><span class="kw">function</span> <span class="at">getUserArrayCheckRank</span>(expected<span class="op">,</span> given<span class="op">,</span> name) <span class="op">{</span></span>
<span id="cb6-177"><a href="#cb6-177"></a>    <span class="cf">if</span> (given <span class="op">!==</span> expected) <span class="op">{</span></span>
<span id="cb6-178"><a href="#cb6-178"></a>        <span class="cf">if</span> (expected <span class="op">===</span> <span class="dv">1</span>) <span class="op">{</span></span>
<span id="cb6-179"><a href="#cb6-179"></a>            <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected a numeric vector for '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb6-180"><a href="#cb6-180"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (expected <span class="op">===</span> <span class="dv">2</span>) <span class="op">{</span></span>
<span id="cb6-181"><a href="#cb6-181"></a>            <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected a numeric matrix for '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb6-182"><a href="#cb6-182"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-183"><a href="#cb6-183"></a>            <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected a numeric array of rank "</span> <span class="op">+</span> expected <span class="op">+</span></span>
<span id="cb6-184"><a href="#cb6-184"></a>                        <span class="st">" for '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb6-185"><a href="#cb6-185"></a>        <span class="op">}</span></span>
<span id="cb6-186"><a href="#cb6-186"></a>    <span class="op">}</span></span>
<span id="cb6-187"><a href="#cb6-187"></a><span class="op">}</span></span>
<span id="cb6-188"><a href="#cb6-188"></a></span>
<span id="cb6-189"><a href="#cb6-189"></a></span>
<span id="cb6-190"><a href="#cb6-190"></a><span class="kw">function</span> <span class="at">getUserArrayCheckContents</span>(data<span class="op">,</span> min<span class="op">,</span> max<span class="op">,</span> isInteger<span class="op">,</span> name) <span class="op">{</span></span>
<span id="cb6-191"><a href="#cb6-191"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">data</span>.<span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) <span class="op">{</span></span>
<span id="cb6-192"><a href="#cb6-192"></a>        <span class="cf">if</span> (<span class="kw">typeof</span> data[i] <span class="op">!==</span> <span class="st">"number"</span>) <span class="op">{</span></span>
<span id="cb6-193"><a href="#cb6-193"></a>            <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected a numeric value for '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb6-194"><a href="#cb6-194"></a>        <span class="op">}</span></span>
<span id="cb6-195"><a href="#cb6-195"></a>        <span class="cf">if</span> (min <span class="op">!==</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> data[i] <span class="op">&lt;</span> min) <span class="op">{</span></span>
<span id="cb6-196"><a href="#cb6-196"></a>            <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"' to be at least "</span> <span class="op">+</span> min)<span class="op">;</span></span>
<span id="cb6-197"><a href="#cb6-197"></a>        <span class="op">}</span></span>
<span id="cb6-198"><a href="#cb6-198"></a>        <span class="cf">if</span> (max <span class="op">!==</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> data[i] <span class="op">&gt;</span> min) <span class="op">{</span></span>
<span id="cb6-199"><a href="#cb6-199"></a>            <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"' to be at most "</span> <span class="op">+</span> max)<span class="op">;</span></span>
<span id="cb6-200"><a href="#cb6-200"></a>        <span class="op">}</span></span>
<span id="cb6-201"><a href="#cb6-201"></a>        <span class="cf">if</span> (isInteger <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="at">numberIsInteger</span>(data[i])) <span class="op">{</span></span>
<span id="cb6-202"><a href="#cb6-202"></a>            <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Expected a integer value for '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb6-203"><a href="#cb6-203"></a>        <span class="op">}</span></span>
<span id="cb6-204"><a href="#cb6-204"></a>    <span class="op">}</span></span>
<span id="cb6-205"><a href="#cb6-205"></a><span class="op">}</span></span>
<span id="cb6-206"><a href="#cb6-206"></a></span>
<span id="cb6-207"><a href="#cb6-207"></a></span>
<span id="cb6-208"><a href="#cb6-208"></a><span class="kw">function</span> <span class="at">checkUser</span>(user<span class="op">,</span> allowed<span class="op">,</span> unusedUserAction) <span class="op">{</span></span>
<span id="cb6-209"><a href="#cb6-209"></a>    <span class="cf">if</span> (unusedUserAction <span class="op">===</span> <span class="kw">undefined</span>) <span class="op">{</span></span>
<span id="cb6-210"><a href="#cb6-210"></a>        unusedUserAction <span class="op">=</span> <span class="st">"stop"</span><span class="op">;</span></span>
<span id="cb6-211"><a href="#cb6-211"></a>    <span class="op">}</span></span>
<span id="cb6-212"><a href="#cb6-212"></a>    <span class="cf">if</span> (unusedUserAction <span class="op">===</span> <span class="st">"ignore"</span>) <span class="op">{</span></span>
<span id="cb6-213"><a href="#cb6-213"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb6-214"><a href="#cb6-214"></a>    <span class="op">}</span></span>
<span id="cb6-215"><a href="#cb6-215"></a>    <span class="kw">var</span> err <span class="op">=</span> <span class="at">setDifference</span>(<span class="va">Object</span>.<span class="at">keys</span>(user)<span class="op">,</span> allowed)<span class="op">;</span></span>
<span id="cb6-216"><a href="#cb6-216"></a>    <span class="cf">if</span> (<span class="va">err</span>.<span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">{</span></span>
<span id="cb6-217"><a href="#cb6-217"></a>        <span class="kw">var</span> msg <span class="op">=</span> <span class="st">"Unknown user parameters: "</span> <span class="op">+</span> <span class="va">err</span>.<span class="at">join</span>(<span class="st">", "</span>)<span class="op">;</span></span>
<span id="cb6-218"><a href="#cb6-218"></a></span>
<span id="cb6-219"><a href="#cb6-219"></a>        <span class="cf">if</span> (unusedUserAction <span class="op">===</span> <span class="st">"message"</span>) <span class="op">{</span></span>
<span id="cb6-220"><a href="#cb6-220"></a>            <span class="at">odinMessage</span>(msg)<span class="op">;</span></span>
<span id="cb6-221"><a href="#cb6-221"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (unusedUserAction <span class="op">===</span> <span class="st">"warning"</span>) <span class="op">{</span></span>
<span id="cb6-222"><a href="#cb6-222"></a>            <span class="at">odinWarning</span>(msg)<span class="op">;</span></span>
<span id="cb6-223"><a href="#cb6-223"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (unusedUserAction <span class="op">===</span> <span class="st">"stop"</span>) <span class="op">{</span></span>
<span id="cb6-224"><a href="#cb6-224"></a>            <span class="cf">throw</span> <span class="at">Error</span>(msg)<span class="op">;</span></span>
<span id="cb6-225"><a href="#cb6-225"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-226"><a href="#cb6-226"></a>            <span class="cf">throw</span> <span class="at">Error</span>(msg <span class="op">+</span> <span class="st">" (and invalid value for unusedUserAction)"</span>)<span class="op">;</span></span>
<span id="cb6-227"><a href="#cb6-227"></a>        <span class="op">}</span></span>
<span id="cb6-228"><a href="#cb6-228"></a>    <span class="op">}</span></span>
<span id="cb6-229"><a href="#cb6-229"></a><span class="op">}</span></span>
<span id="cb6-230"><a href="#cb6-230"></a></span>
<span id="cb6-231"><a href="#cb6-231"></a></span>
<span id="cb6-232"><a href="#cb6-232"></a><span class="kw">function</span> <span class="at">isMissing</span>(x) <span class="op">{</span></span>
<span id="cb6-233"><a href="#cb6-233"></a>    <span class="cf">return</span> x <span class="op">===</span> <span class="kw">undefined</span> <span class="op">||</span> x <span class="op">===</span> <span class="kw">null</span> <span class="op">||</span></span>
<span id="cb6-234"><a href="#cb6-234"></a>        (<span class="kw">typeof</span> x <span class="op">===</span> <span class="st">"number"</span> <span class="op">&amp;&amp;</span> <span class="at">isNaN</span>(x))<span class="op">;</span></span>
<span id="cb6-235"><a href="#cb6-235"></a><span class="op">}</span></span>
<span id="cb6-236"><a href="#cb6-236"></a></span>
<span id="cb6-237"><a href="#cb6-237"></a></span>
<span id="cb6-238"><a href="#cb6-238"></a><span class="co">// Travis has ancient v8 version that lacks Number.isNumber.  However</span></span>
<span id="cb6-239"><a href="#cb6-239"></a><span class="co">// it also lacks Number.EPSILON so I'm just comparing against 1e-8</span></span>
<span id="cb6-240"><a href="#cb6-240"></a><span class="co">// which is close enough to sqrt(double.eps) anyway</span></span>
<span id="cb6-241"><a href="#cb6-241"></a><span class="kw">function</span> <span class="at">numberIsInteger</span>(x) <span class="op">{</span></span>
<span id="cb6-242"><a href="#cb6-242"></a>    <span class="cf">return</span> <span class="va">Math</span>.<span class="at">abs</span>(x <span class="op">-</span> <span class="va">Math</span>.<span class="at">round</span>(x)) <span class="op">&lt;</span> <span class="fl">1e-8</span></span>
<span id="cb6-243"><a href="#cb6-243"></a><span class="op">}</span></span>
<span id="cb6-244"><a href="#cb6-244"></a></span>
<span id="cb6-245"><a href="#cb6-245"></a></span>
<span id="cb6-246"><a href="#cb6-246"></a><span class="co">// O(n^2) but does not use Set, which is not available in old v8</span></span>
<span id="cb6-247"><a href="#cb6-247"></a><span class="kw">function</span> <span class="at">setDifference</span>(a<span class="op">,</span> b) <span class="op">{</span></span>
<span id="cb6-248"><a href="#cb6-248"></a>  <span class="kw">var</span> result <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb6-249"><a href="#cb6-249"></a>  <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">a</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></span>
<span id="cb6-250"><a href="#cb6-250"></a>    <span class="cf">if</span> (<span class="va">b</span>.<span class="at">indexOf</span>(a[i]) <span class="op">===</span> <span class="dv">-1</span>) <span class="op">{</span></span>
<span id="cb6-251"><a href="#cb6-251"></a>      <span class="va">result</span>.<span class="at">push</span>(a[i])<span class="op">;</span></span>
<span id="cb6-252"><a href="#cb6-252"></a>    <span class="op">}</span></span>
<span id="cb6-253"><a href="#cb6-253"></a>  <span class="op">}</span></span>
<span id="cb6-254"><a href="#cb6-254"></a>  <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb6-255"><a href="#cb6-255"></a><span class="op">}</span></span>
<span id="cb6-256"><a href="#cb6-256"></a></span>
<span id="cb6-257"><a href="#cb6-257"></a></span>
<span id="cb6-258"><a href="#cb6-258"></a><span class="co">// nice behaviour both in and out of R</span></span>
<span id="cb6-259"><a href="#cb6-259"></a><span class="kw">function</span> <span class="at">odinWarning</span>(msg) <span class="op">{</span></span>
<span id="cb6-260"><a href="#cb6-260"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb6-261"><a href="#cb6-261"></a>        <span class="va">console</span>.<span class="va">r</span>.<span class="at">call</span>(<span class="st">"warning"</span><span class="op">,</span> msg)</span>
<span id="cb6-262"><a href="#cb6-262"></a>    <span class="op">}</span> <span class="cf">catch</span> (e) <span class="op">{</span></span>
<span id="cb6-263"><a href="#cb6-263"></a>        <span class="va">console</span>.<span class="at">warn</span>(msg)</span>
<span id="cb6-264"><a href="#cb6-264"></a>    <span class="op">}</span></span>
<span id="cb6-265"><a href="#cb6-265"></a><span class="op">}</span></span>
<span id="cb6-266"><a href="#cb6-266"></a></span>
<span id="cb6-267"><a href="#cb6-267"></a></span>
<span id="cb6-268"><a href="#cb6-268"></a><span class="kw">function</span> <span class="at">odinMessage</span>(msg) <span class="op">{</span></span>
<span id="cb6-269"><a href="#cb6-269"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb6-270"><a href="#cb6-270"></a>        <span class="va">console</span>.<span class="va">r</span>.<span class="at">call</span>(<span class="st">"message"</span><span class="op">,</span> msg)</span>
<span id="cb6-271"><a href="#cb6-271"></a>    <span class="op">}</span> <span class="cf">catch</span> (e) <span class="op">{</span></span>
<span id="cb6-272"><a href="#cb6-272"></a>        <span class="va">console</span>.<span class="at">warn</span>(msg)</span>
<span id="cb6-273"><a href="#cb6-273"></a>    <span class="op">}</span></span>
<span id="cb6-274"><a href="#cb6-274"></a><span class="op">}</span></span>
<span id="cb6-275"><a href="#cb6-275"></a></span>
<span id="cb6-276"><a href="#cb6-276"></a></span>
<span id="cb6-277"><a href="#cb6-277"></a><span class="kw">function</span> <span class="at">flattenArray</span>(value<span class="op">,</span> name) <span class="op">{</span></span>
<span id="cb6-278"><a href="#cb6-278"></a>    <span class="kw">var</span> len <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb6-279"><a href="#cb6-279"></a>    <span class="kw">var</span> dim <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb6-280"><a href="#cb6-280"></a>    <span class="kw">var</span> x <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb6-281"><a href="#cb6-281"></a>    <span class="cf">while</span> (<span class="va">Array</span>.<span class="at">isArray</span>(x)) <span class="op">{</span></span>
<span id="cb6-282"><a href="#cb6-282"></a>        <span class="va">dim</span>.<span class="at">push</span>(<span class="va">x</span>.<span class="at">length</span>)<span class="op">;</span></span>
<span id="cb6-283"><a href="#cb6-283"></a>        len <span class="op">*=</span> <span class="va">x</span>.<span class="at">length</span><span class="op">;</span></span>
<span id="cb6-284"><a href="#cb6-284"></a>        x <span class="op">=</span> x[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb6-285"><a href="#cb6-285"></a>    <span class="op">}</span></span>
<span id="cb6-286"><a href="#cb6-286"></a>    <span class="va">dim</span>.<span class="at">reverse</span>()<span class="op">;</span></span>
<span id="cb6-287"><a href="#cb6-287"></a></span>
<span id="cb6-288"><a href="#cb6-288"></a>    <span class="kw">var</span> data <span class="op">=</span> <span class="at">flatten</span>(value<span class="op">,</span> [])<span class="op">;</span></span>
<span id="cb6-289"><a href="#cb6-289"></a></span>
<span id="cb6-290"><a href="#cb6-290"></a>    <span class="co">// Not a suffient check, but at least a necessary one:</span></span>
<span id="cb6-291"><a href="#cb6-291"></a>    <span class="cf">if</span> (len <span class="op">!==</span> <span class="va">data</span>.<span class="at">length</span>) <span class="op">{</span></span>
<span id="cb6-292"><a href="#cb6-292"></a>        <span class="cf">throw</span> <span class="at">Error</span>(<span class="st">"Inconsistent array for '"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">'"'</span>)<span class="op">;</span></span>
<span id="cb6-293"><a href="#cb6-293"></a>    <span class="op">}</span></span>
<span id="cb6-294"><a href="#cb6-294"></a></span>
<span id="cb6-295"><a href="#cb6-295"></a>    <span class="cf">return</span> <span class="op">{</span><span class="dt">data</span><span class="op">:</span> data<span class="op">,</span> <span class="dt">dim</span><span class="op">:</span> dim<span class="op">};</span></span>
<span id="cb6-296"><a href="#cb6-296"></a><span class="op">}</span></span>
<span id="cb6-297"><a href="#cb6-297"></a></span>
<span id="cb6-298"><a href="#cb6-298"></a></span>
<span id="cb6-299"><a href="#cb6-299"></a><span class="kw">function</span> <span class="at">flatten</span>(array<span class="op">,</span> result) <span class="op">{</span></span>
<span id="cb6-300"><a href="#cb6-300"></a>  <span class="cf">if</span> (<span class="va">array</span>.<span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="op">{</span></span>
<span id="cb6-301"><a href="#cb6-301"></a>    <span class="cf">return</span> result</span>
<span id="cb6-302"><a href="#cb6-302"></a>  <span class="op">}</span></span>
<span id="cb6-303"><a href="#cb6-303"></a>  <span class="kw">var</span> head <span class="op">=</span> array[<span class="dv">0</span>]</span>
<span id="cb6-304"><a href="#cb6-304"></a>  <span class="kw">var</span> rest <span class="op">=</span> <span class="va">array</span>.<span class="at">slice</span>(<span class="dv">1</span>)</span>
<span id="cb6-305"><a href="#cb6-305"></a>  <span class="cf">if</span> (<span class="va">Array</span>.<span class="at">isArray</span>(head)) <span class="op">{</span></span>
<span id="cb6-306"><a href="#cb6-306"></a>    <span class="cf">return</span> <span class="at">flatten</span>(<span class="va">head</span>.<span class="at">concat</span>(rest)<span class="op">,</span> result)</span>
<span id="cb6-307"><a href="#cb6-307"></a>  <span class="op">}</span></span>
<span id="cb6-308"><a href="#cb6-308"></a>  <span class="va">result</span>.<span class="at">push</span>(head)</span>
<span id="cb6-309"><a href="#cb6-309"></a>  <span class="cf">return</span> <span class="at">flatten</span>(rest<span class="op">,</span> result)</span>
<span id="cb6-310"><a href="#cb6-310"></a><span class="op">}</span></span>
<span id="cb6-311"><a href="#cb6-311"></a></span>
<span id="cb6-312"><a href="#cb6-312"></a></span>
<span id="cb6-313"><a href="#cb6-313"></a><span class="co">// https://en.wikipedia.org/wiki/Rounding#Round_half_to_even - same</span></span>
<span id="cb6-314"><a href="#cb6-314"></a><span class="co">// behaviour as R and IEEE 754, with better biases.</span></span>
<span id="cb6-315"><a href="#cb6-315"></a><span class="kw">function</span> <span class="at">roundHalfToEven</span>(x) <span class="op">{</span></span>
<span id="cb6-316"><a href="#cb6-316"></a>    <span class="cf">if</span> (<span class="at">modr</span>(x<span class="op">,</span> <span class="dv">1</span>) <span class="op">===</span> <span class="fl">0.5</span>) <span class="op">{</span></span>
<span id="cb6-317"><a href="#cb6-317"></a>        <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> <span class="va">Math</span>.<span class="at">round</span>(x <span class="op">/</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb6-318"><a href="#cb6-318"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-319"><a href="#cb6-319"></a>        <span class="cf">return</span> <span class="va">Math</span>.<span class="at">round</span>(x)<span class="op">;</span></span>
<span id="cb6-320"><a href="#cb6-320"></a>    <span class="op">}</span></span>
<span id="cb6-321"><a href="#cb6-321"></a><span class="op">}</span></span>
<span id="cb6-322"><a href="#cb6-322"></a></span>
<span id="cb6-323"><a href="#cb6-323"></a></span>
<span id="cb6-324"><a href="#cb6-324"></a><span class="kw">function</span> <span class="at">round2</span>(x<span class="op">,</span> digits) <span class="op">{</span></span>
<span id="cb6-325"><a href="#cb6-325"></a>    <span class="cf">if</span> (digits <span class="op">===</span> <span class="kw">undefined</span>) <span class="op">{</span></span>
<span id="cb6-326"><a href="#cb6-326"></a>        <span class="cf">return</span> <span class="at">roundHalfToEven</span>(x)<span class="op">;</span></span>
<span id="cb6-327"><a href="#cb6-327"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-328"><a href="#cb6-328"></a>        <span class="kw">var</span> mult <span class="op">=</span> <span class="va">Math</span>.<span class="at">pow</span>(<span class="dv">10</span><span class="op">,</span> digits)<span class="op">;</span></span>
<span id="cb6-329"><a href="#cb6-329"></a>        <span class="cf">return</span> <span class="at">roundHalfToEven</span>(x <span class="op">*</span> mult) <span class="op">/</span> mult<span class="op">;</span></span>
<span id="cb6-330"><a href="#cb6-330"></a>    <span class="op">}</span></span>
<span id="cb6-331"><a href="#cb6-331"></a><span class="op">}</span></span>
<span id="cb6-332"><a href="#cb6-332"></a></span>
<span id="cb6-333"><a href="#cb6-333"></a><span class="co">// modulo that conforms to (approximately) the same behaviour as R</span></span>
<span id="cb6-334"><a href="#cb6-334"></a><span class="kw">function</span> <span class="at">modr</span>(x<span class="op">,</span> y) <span class="op">{</span></span>
<span id="cb6-335"><a href="#cb6-335"></a>    <span class="kw">var</span> tmp <span class="op">=</span> x <span class="op">%</span> y<span class="op">;</span></span>
<span id="cb6-336"><a href="#cb6-336"></a>    <span class="cf">if</span> (tmp <span class="op">*</span> y <span class="op">&lt;</span> <span class="dv">0</span>) <span class="op">{</span></span>
<span id="cb6-337"><a href="#cb6-337"></a>        tmp <span class="op">+=</span> y<span class="op">;</span></span>
<span id="cb6-338"><a href="#cb6-338"></a>    <span class="op">}</span></span>
<span id="cb6-339"><a href="#cb6-339"></a>    <span class="cf">return</span> tmp<span class="op">;</span></span>
<span id="cb6-340"><a href="#cb6-340"></a><span class="op">}</span></span>
<span id="cb6-341"><a href="#cb6-341"></a></span>
<span id="cb6-342"><a href="#cb6-342"></a></span>
<span id="cb6-343"><a href="#cb6-343"></a><span class="kw">function</span> <span class="at">intdivr</span>(x<span class="op">,</span> y) <span class="op">{</span></span>
<span id="cb6-344"><a href="#cb6-344"></a>    <span class="cf">return</span> <span class="va">Math</span>.<span class="at">floor</span>(x <span class="op">/</span> y)<span class="op">;</span></span>
<span id="cb6-345"><a href="#cb6-345"></a><span class="op">}</span></span>
<span id="cb6-346"><a href="#cb6-346"></a></span>
<span id="cb6-347"><a href="#cb6-347"></a></span>
<span id="cb6-348"><a href="#cb6-348"></a><span class="co">// Ranks 2..8 created by scripts/create_support_sum_js.R</span></span>
<span id="cb6-349"><a href="#cb6-349"></a><span class="kw">function</span> <span class="at">odinSum1</span>(x<span class="op">,</span> <span class="im">from</span><span class="op">,</span> to) <span class="op">{</span></span>
<span id="cb6-350"><a href="#cb6-350"></a>    <span class="kw">var</span> tot <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb6-351"><a href="#cb6-351"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="im">from</span><span class="op">;</span> i <span class="op">&lt;</span> to<span class="op">;</span> <span class="op">++</span>i) <span class="op">{</span></span>
<span id="cb6-352"><a href="#cb6-352"></a>        tot <span class="op">+=</span> x[i]<span class="op">;</span></span>
<span id="cb6-353"><a href="#cb6-353"></a>    <span class="op">}</span></span>
<span id="cb6-354"><a href="#cb6-354"></a>    <span class="cf">return</span> tot<span class="op">;</span></span>
<span id="cb6-355"><a href="#cb6-355"></a><span class="op">}</span></span>
<span id="cb6-356"><a href="#cb6-356"></a><span class="kw">var</span> odin <span class="op">=</span> <span class="op">{};</span></span>
<span id="cb6-357"><a href="#cb6-357"></a><span class="va">odin</span>.<span class="at">logistic</span> <span class="op">=</span> (<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb6-358"><a href="#cb6-358"></a>  <span class="kw">function</span> <span class="at">logistic</span>(user<span class="op">,</span> unusedUserAction) <span class="op">{</span></span>
<span id="cb6-359"><a href="#cb6-359"></a>    <span class="kw">this</span>.<span class="at">internal</span> <span class="op">=</span> <span class="op">{};</span></span>
<span id="cb6-360"><a href="#cb6-360"></a>    <span class="kw">var</span> internal <span class="op">=</span> <span class="kw">this</span>.<span class="at">internal</span><span class="op">;</span></span>
<span id="cb6-361"><a href="#cb6-361"></a>    <span class="va">internal</span>.<span class="at">K</span> <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb6-362"><a href="#cb6-362"></a>    <span class="kw">this</span>.<span class="at">setUser</span>(user<span class="op">,</span> unusedUserAction)<span class="op">;</span></span>
<span id="cb6-363"><a href="#cb6-363"></a>  <span class="op">}</span></span>
<span id="cb6-364"><a href="#cb6-364"></a>  <span class="va">logistic</span>.<span class="va">prototype</span>.<span class="at">setUser</span> <span class="op">=</span> <span class="kw">function</span>(user<span class="op">,</span> unusedUserAction) <span class="op">{</span></span>
<span id="cb6-365"><a href="#cb6-365"></a>    <span class="at">checkUser</span>(user<span class="op">,</span> [<span class="st">"r"</span><span class="op">,</span> <span class="st">"N0"</span>]<span class="op">,</span> unusedUserAction)<span class="op">;</span></span>
<span id="cb6-366"><a href="#cb6-366"></a>    <span class="kw">var</span> internal <span class="op">=</span> <span class="kw">this</span>.<span class="at">internal</span><span class="op">;</span></span>
<span id="cb6-367"><a href="#cb6-367"></a>    <span class="at">getUser</span>(user<span class="op">,</span> <span class="st">"N0"</span><span class="op">,</span> internal<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb6-368"><a href="#cb6-368"></a>    <span class="at">getUser</span>(user<span class="op">,</span> <span class="st">"r"</span><span class="op">,</span> internal<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb6-369"><a href="#cb6-369"></a>    <span class="va">internal</span>.<span class="at">initial_N</span> <span class="op">=</span> <span class="va">internal</span>.<span class="at">N0</span><span class="op">;</span></span>
<span id="cb6-370"><a href="#cb6-370"></a>    <span class="kw">this</span>.<span class="at">updateMetadata</span>()<span class="op">;</span></span>
<span id="cb6-371"><a href="#cb6-371"></a>  <span class="op">};</span></span>
<span id="cb6-372"><a href="#cb6-372"></a>  <span class="va">logistic</span>.<span class="va">prototype</span>.<span class="at">rhs</span> <span class="op">=</span> <span class="kw">function</span>(t<span class="op">,</span> state<span class="op">,</span> dstatedt) <span class="op">{</span></span>
<span id="cb6-373"><a href="#cb6-373"></a>    <span class="kw">var</span> internal <span class="op">=</span> <span class="kw">this</span>.<span class="at">internal</span><span class="op">;</span></span>
<span id="cb6-374"><a href="#cb6-374"></a>    <span class="kw">var</span> N <span class="op">=</span> state[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb6-375"><a href="#cb6-375"></a>    dstatedt[<span class="dv">0</span>] <span class="op">=</span> <span class="va">internal</span>.<span class="at">r</span> <span class="op">*</span> N <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> N <span class="op">/</span> <span class="va">internal</span>.<span class="at">K</span>)<span class="op">;</span></span>
<span id="cb6-376"><a href="#cb6-376"></a>  <span class="op">};</span></span>
<span id="cb6-377"><a href="#cb6-377"></a>  <span class="va">logistic</span>.<span class="va">prototype</span>.<span class="at">interpolateTime</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb6-378"><a href="#cb6-378"></a>  <span class="va">logistic</span>.<span class="va">prototype</span>.<span class="at">rhsEval</span> <span class="op">=</span> <span class="kw">function</span>(t<span class="op">,</span> state) <span class="op">{</span></span>
<span id="cb6-379"><a href="#cb6-379"></a>    <span class="kw">var</span> dstatedt <span class="op">=</span> <span class="at">zeros</span>(<span class="va">state</span>.<span class="at">length</span>)<span class="op">;</span></span>
<span id="cb6-380"><a href="#cb6-380"></a>    <span class="kw">this</span>.<span class="at">rhs</span>(t<span class="op">,</span> state<span class="op">,</span> dstatedt)<span class="op">;</span></span>
<span id="cb6-381"><a href="#cb6-381"></a>    <span class="cf">return</span> dstatedt<span class="op">;</span></span>
<span id="cb6-382"><a href="#cb6-382"></a>  <span class="op">};</span></span>
<span id="cb6-383"><a href="#cb6-383"></a>  <span class="va">logistic</span>.<span class="va">prototype</span>.<span class="at">initial</span> <span class="op">=</span> <span class="kw">function</span>(t) <span class="op">{</span></span>
<span id="cb6-384"><a href="#cb6-384"></a>    <span class="kw">var</span> internal <span class="op">=</span> <span class="kw">this</span>.<span class="at">internal</span><span class="op">;</span></span>
<span id="cb6-385"><a href="#cb6-385"></a>    <span class="kw">var</span> state <span class="op">=</span> <span class="at">zeros</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb6-386"><a href="#cb6-386"></a>    state[<span class="dv">0</span>] <span class="op">=</span> <span class="va">internal</span>.<span class="at">initial_N</span><span class="op">;</span></span>
<span id="cb6-387"><a href="#cb6-387"></a>    <span class="cf">return</span> state<span class="op">;</span></span>
<span id="cb6-388"><a href="#cb6-388"></a>  <span class="op">};</span></span>
<span id="cb6-389"><a href="#cb6-389"></a>  <span class="va">logistic</span>.<span class="va">prototype</span>.<span class="at">run</span> <span class="op">=</span> <span class="kw">function</span>(times<span class="op">,</span> y0<span class="op">,</span> tcrit<span class="op">,</span> atol<span class="op">,</span> rtol<span class="op">,</span> maxSteps) <span class="op">{</span></span>
<span id="cb6-390"><a href="#cb6-390"></a>    <span class="cf">return</span> <span class="at">integrateOdin</span>(<span class="kw">this</span><span class="op">,</span> times<span class="op">,</span> y0<span class="op">,</span> tcrit<span class="op">,</span> atol<span class="op">,</span> rtol<span class="op">,</span> maxSteps)<span class="op">;</span></span>
<span id="cb6-391"><a href="#cb6-391"></a>  <span class="op">};</span></span>
<span id="cb6-392"><a href="#cb6-392"></a>  <span class="va">logistic</span>.<span class="va">prototype</span>.<span class="at">coef</span> <span class="op">=</span> <span class="op">{</span><span class="dt">r</span><span class="op">:</span> <span class="op">{</span><span class="dt">has_default</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="cf">default</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">rank</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="kw">Infinity</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="kw">Infinity</span><span class="op">,</span> <span class="dt">integer</span><span class="op">:</span> <span class="kw">false</span><span class="op">},</span> <span class="dt">N0</span><span class="op">:</span> <span class="op">{</span><span class="dt">has_default</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="cf">default</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">rank</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="kw">Infinity</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="kw">Infinity</span><span class="op">,</span> <span class="dt">integer</span><span class="op">:</span> <span class="kw">false</span><span class="op">}};</span></span>
<span id="cb6-393"><a href="#cb6-393"></a>  <span class="va">logistic</span>.<span class="va">prototype</span>.<span class="at">updateMetadata</span> <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb6-394"><a href="#cb6-394"></a>    <span class="kw">this</span>.<span class="at">metadata</span> <span class="op">=</span> <span class="op">{};</span></span>
<span id="cb6-395"><a href="#cb6-395"></a>    <span class="kw">var</span> internal <span class="op">=</span> <span class="kw">this</span>.<span class="at">internal</span><span class="op">;</span></span>
<span id="cb6-396"><a href="#cb6-396"></a>    <span class="kw">this</span>.<span class="va">metadata</span>.<span class="at">ynames</span> <span class="op">=</span> [<span class="st">"t"</span><span class="op">,</span> <span class="st">"N"</span>]<span class="op">;</span></span>
<span id="cb6-397"><a href="#cb6-397"></a>    <span class="kw">this</span>.<span class="va">metadata</span>.<span class="at">interpolateTimes</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb6-398"><a href="#cb6-398"></a>    <span class="kw">this</span>.<span class="va">metadata</span>.<span class="at">internalOrder</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb6-399"><a href="#cb6-399"></a>  <span class="st">"initial_N"</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb6-400"><a href="#cb6-400"></a>  <span class="st">"K"</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb6-401"><a href="#cb6-401"></a>  <span class="st">"N0"</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb6-402"><a href="#cb6-402"></a>  <span class="st">"r"</span><span class="op">:</span> <span class="kw">null</span></span>
<span id="cb6-403"><a href="#cb6-403"></a><span class="op">};</span></span>
<span id="cb6-404"><a href="#cb6-404"></a>    <span class="kw">this</span>.<span class="va">metadata</span>.<span class="at">variableOrder</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb6-405"><a href="#cb6-405"></a>  <span class="st">"N"</span><span class="op">:</span> <span class="kw">null</span></span>
<span id="cb6-406"><a href="#cb6-406"></a><span class="op">};</span></span>
<span id="cb6-407"><a href="#cb6-407"></a>    <span class="kw">this</span>.<span class="va">metadata</span>.<span class="at">outputOrder</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb6-408"><a href="#cb6-408"></a>  <span class="op">};</span></span>
<span id="cb6-409"><a href="#cb6-409"></a>  <span class="cf">return</span> logistic<span class="op">;</span></span>
<span id="cb6-410"><a href="#cb6-410"></a><span class="op">}</span>())<span class="op">;</span></span></code></pre></div>
<p>(the option <code>include_dopri</code> prevents the <a href="https://github.com/mrc-ide/dopri-js"><code>dopri-js</code></a> solver being included here as that can be included separately and ends up being ~500 lines of extra code).</p>
</div>
<div id="complete-example" class="section level3">
<h3 class="hasAnchor">
<a href="#complete-example" class="anchor"></a>Complete example</h3>
<p>A more complete example that can actually be used from a webpage is included:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu">odin.js</span><span class="fu">::</span><span class="fu"><a href="reference/odin_js_example.html">odin_js_example</a></span><span class="op">(</span><span class="st">"inst/models/sir.R"</span>, <span class="st">"simple"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "index.html" "odin.js"</code></pre>
<p>Chrome will not let you execute js directly off disk (though I think Firefox does) so to test this you should use something like <a href="https://docs.python.org/2/library/simplehttpserver.html">SimpleHttpServer</a> to serve the directory and access that way. This example is also available at <a href="https://mrc-ide.github.io/odin.js/simple">mrc-ide.github.io/odin.js/simple</a></p>
</div>
<div id="supported-features" class="section level3">
<h3 class="hasAnchor">
<a href="#supported-features" class="anchor"></a>Supported features</h3>
<ul>
<li>
<input type="checkbox" disabled checked>
user variables</li>
<li>
<input type="checkbox" disabled checked>
output</li>
<li>
<input type="checkbox" disabled checked>
arrays</li>
<li>
<input type="checkbox" disabled>
delays</li>
<li>
<input type="checkbox" disabled checked>
interpolation</li>
<li>
<input type="checkbox" disabled checked>
discrete models</li>
<li>
<input type="checkbox" disabled checked>
stochastic models</li>
</ul>
</div>
<div id="limitations-and-differences" class="section level3">
<h3 class="hasAnchor">
<a href="#limitations-and-differences" class="anchor"></a>Limitations and differences</h3>
<ul>
<li>The <code>use_dde</code> option to the constructor has gone</li>
<li>Minor error message changes</li>
<li>Stochastic interface does not use R’s RNG so results are different and seed setting is not obvious</li>
</ul>
<hr>
<p>Please note that the ‘odin.js’ project is released with a <a href="CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Rich FitzJohn <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.repostatus.org/#wip"><img src="https://www.repostatus.org/badges/latest/wip.svg" alt="Project Status: WIP – Initial development is in progress, but there has not yet been a stable, usable release suitable for the public."></a></li>
<li><a href="https://github.com/mrc-ide/odin.js/actions"><img src="https://github.com/mrc-ide/odin.js/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
<li><a href="https://codecov.io/github/mrc-ide/odin.js?branch=master"><img src="https://codecov.io/github/mrc-ide/odin.js/coverage.svg?branch=master" alt="codecov.io"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Rich FitzJohn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
